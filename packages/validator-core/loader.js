"use strict";var nn=Object.create;var be=Object.defineProperty;var tn=Object.getOwnPropertyDescriptor;var rn=Object.getOwnPropertyNames;var on=Object.getPrototypeOf,sn=Object.prototype.hasOwnProperty;var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var un=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of rn(t))!sn.call(e,o)&&o!==n&&be(e,o,{get:()=>t[o],enumerable:!(r=tn(t,o))||r.enumerable});return e};var h=(e,t,n)=>(n=e!=null?nn(on(e)):{},un(t||!e||!e.__esModule?be(n,"default",{value:e,enumerable:!0}):n,e));var V=(e,t,n)=>new Promise((r,o)=>{var l=F=>{try{C(n.next(F))}catch(S){o(S)}},d=F=>{try{C(n.throw(F))}catch(S){o(S)}},C=F=>F.done?r(F.value):Promise.resolve(F.value).then(l,d);C((n=n.apply(e,t)).next())});var D=y(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var A=class extends Error{constructor(...t){super(...t),this.message=t[0],this.detail=t[1],this.className=A.name,Error.captureStackTrace&&Error.captureStackTrace(this,A)}};ne.default=A});var k=y($=>{"use strict";Object.defineProperty($,"__esModule",{value:!0});$.trueTypeOf=void 0;function fn(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}$.trueTypeOf=fn});var se=y(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.formatStr=c.showDeep=c.nil=c.createEvtName=c.parseJson=c.toArray=c.inArray=void 0;var pn=k(),mn=(e,t)=>e.includes(t);c.inArray=mn;var gn=e=>Array.isArray(e)?e:[e];c.toArray=gn;var dn=(e,t=!0)=>{try{return(0,pn.trueTypeOf)(e)==="string"?JSON.parse(e):JSON.parse(JSON.stringify(e))}catch(n){if(t)return e;throw n}};c.parseJson=dn;var yn=(...e)=>e.join("_");c.createEvtName=yn;var hn=()=>!1;c.nil=hn;var Cn=e=>{console.dir(e,{depth:null})};c.showDeep=Cn;function bn(e,...t){return e.replace(/{([0-9]+)}/g,(n,r)=>typeof t[r]>"u"?n:t[r])}c.formatStr=bn});var ae=y(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.readOnly=a.objectHasKey=a.arrToObj=a.assign=a.getConfigValue=a.isClass=a.isPlainObject=a.isObject=void 0;var Fn=se(),Pn=k();function ie(e){return(0,Pn.trueTypeOf)(e)==="object"}a.isObject=ie;function ue(e){if(ie(e)){let n=e.constructor.prototype,r="[Object: null prototype]";return n.toString().substring(0,r.length)===r?!0:ie(n)===!1?!1:Reflect.apply(n.hasOwnProperty,n,["isPrototypeOf"])}return!1}a.isPlainObject=ue;var En=e=>!ue(e);a.isClass=En;var _n=(e,t)=>t&&ue(t)&&e in t?t[e]:void 0;a.getConfigValue=_n;var xn=(...e)=>Reflect.apply(Object.assign,Object,e);a.assign=xn;var An=(e,t,n={})=>e.map(t).reduce((r,o)=>(0,a.assign)(r,o),n);a.arrToObj=An;var wn=(e,t)=>{try{let n=Object.keys(e);return(0,Fn.inArray)(n,t)}catch{return!1}};a.objectHasKey=wn;var On=e=>Object.freeze(e);a.readOnly=On});var le=y(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.isString=p.flatMap=p.merge=p.curry=void 0;var Rn=k(),ce=ae(),Tn=(e,...t)=>e.length<=t.length?e(...t):(...n)=>(0,p.curry)(e,...t,...n);p.curry=Tn;var vn=(e,...t)=>{if(!t.length)return e;let n=t.shift();if((0,ce.isObject)(e)&&(0,ce.isObject)(n))for(let r in n)(0,ce.isObject)(n[r])?(e[r]||Object.assign(e,{[r]:{}}),(0,p.merge)(e[r],n[r])):Object.assign(e,{[r]:n[r]});return(0,p.merge)(e,...t)};p.merge=vn;function qn(e,t){return t||(t=n=>n),e.flatMap(t)}p.flatMap=qn;function jn(e){return(0,Rn.trueTypeOf)(e)==="string"}p.isString=jn});var ve=y(me=>{"use strict";Object.defineProperty(me,"__esModule",{value:!0});var O=class extends Error{constructor(...t){super(...t),this.message=t[0],this.detail=t[1],this.className=O.name,Error.captureStackTrace&&Error.captureStackTrace(this,O)}};me.default=O});var Je=y(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.isAsyncFunction=R.isFunction=void 0;var qe=k(),je=["asyncfunction","function"],Xn=function(e,t=!1){let n=(0,qe.trueTypeOf)(e);return je.includes(n)?!0:(t&&console.error(`Expect to be Function type! Got ${typeof e}`),!1)};R.isFunction=Xn;function Qn(e){return(0,qe.trueTypeOf)(e)===je[0]}R.isAsyncFunction=Qn});var Ye=y(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.getRegex=T.isRegExp=void 0;var et=le();function Se(e){return e instanceof RegExp}T.isRegExp=Se;function nt(e){switch(!0){case Se(e):return e;case(0,et.isString)(e):return new RegExp(e);default:return!1}}T.getRegex=nt});var ke=y((ur,Me)=>{var v=1e3,q=v*60,j=q*60,_=j*24,tt=_*7,rt=_*365.25;Me.exports=function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return ot(e);if(n==="number"&&isFinite(e))return t.long?it(e):st(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function ot(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*rt;case"weeks":case"week":case"w":return n*tt;case"days":case"day":case"d":return n*_;case"hours":case"hour":case"hrs":case"hr":case"h":return n*j;case"minutes":case"minute":case"mins":case"min":case"m":return n*q;case"seconds":case"second":case"secs":case"sec":case"s":return n*v;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function st(e){var t=Math.abs(e);return t>=_?Math.round(e/_)+"d":t>=j?Math.round(e/j)+"h":t>=q?Math.round(e/q)+"m":t>=v?Math.round(e/v)+"s":e+"ms"}function it(e){var t=Math.abs(e);return t>=_?W(e,t,_,"day"):t>=j?W(e,t,j,"hour"):t>=q?W(e,t,q,"minute"):t>=v?W(e,t,v,"second"):e+" ms"}function W(e,t,n,r){var o=t>=n*1.5;return Math.round(e/n)+" "+r+(o?"s":"")}});var Ie=y((ar,Ne)=>{function ut(e){n.debug=n,n.default=n,n.coerce=F,n.disable=l,n.enable=o,n.enabled=d,n.humanize=ke(),n.destroy=S,Object.keys(e).forEach(s=>{n[s]=e[s]}),n.names=[],n.skips=[],n.formatters={};function t(s){let i=0;for(let u=0;u<s.length;u++)i=(i<<5)-i+s.charCodeAt(u),i|=0;return n.colors[Math.abs(i)%n.colors.length]}n.selectColor=t;function n(s){let i,u=null,N,he;function b(...g){if(!b.enabled)return;let E=b,I=Number(new Date),Xe=I-(i||I);E.diff=Xe,E.prev=i,E.curr=I,i=I,g[0]=n.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let K=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(ee,Qe)=>{if(ee==="%%")return"%";K++;let Ce=n.formatters[Qe];if(typeof Ce=="function"){let en=g[K];ee=Ce.call(E,en),g.splice(K,1),K--}return ee}),n.formatArgs.call(E,g),(E.log||n.log).apply(E,g)}return b.namespace=s,b.useColors=n.useColors(),b.color=n.selectColor(s),b.extend=r,b.destroy=n.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(N!==n.namespaces&&(N=n.namespaces,he=n.enabled(s)),he),set:g=>{u=g}}),typeof n.init=="function"&&n.init(b),b}function r(s,i){let u=n(this.namespace+(typeof i>"u"?":":i)+s);return u.log=this.log,u}function o(s){n.save(s),n.namespaces=s,n.names=[],n.skips=[];let i,u=(typeof s=="string"?s:"").split(/[\s,]+/),N=u.length;for(i=0;i<N;i++)!u[i]||(s=u[i].replace(/\*/g,".*?"),s[0]==="-"?n.skips.push(new RegExp("^"+s.slice(1)+"$")):n.names.push(new RegExp("^"+s+"$")))}function l(){let s=[...n.names.map(C),...n.skips.map(C).map(i=>"-"+i)].join(",");return n.enable(""),s}function d(s){if(s[s.length-1]==="*")return!0;let i,u;for(i=0,u=n.skips.length;i<u;i++)if(n.skips[i].test(s))return!1;for(i=0,u=n.names.length;i<u;i++)if(n.names[i].test(s))return!0;return!1}function C(s){return s.toString().substring(2,s.toString().length-2).replace(/\.\*\?$/,"*")}function F(s){return s instanceof Error?s.stack||s.message:s}function S(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}Ne.exports=ut});var ge=y((m,Z)=>{m.formatArgs=ct;m.save=lt;m.load=ft;m.useColors=at;m.storage=pt();m.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();m.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function at(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ct(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Z.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(r=n))}),e.splice(r,0,t)}m.log=console.debug||console.log||(()=>{});function lt(e){try{e?m.storage.setItem("debug",e):m.storage.removeItem("debug")}catch{}}function ft(){let e;try{e=m.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function pt(){try{return localStorage}catch{}}Z.exports=Ie()(m);var{formatters:mt}=Z.exports;mt.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var J=h(D());var an="validate",Y="validateAsync",te="plugin",w="main",cn="pattern",ln="rules",Fe="name",f="params",L="$$idx",Pe="$$value",M="Your plugin config argument contains reserved keywords",re="Your params doesn't matching your main argument list",oe="Can not find 'main' method in your plugin config",Ee=[f,cn,an,Y,te,ln,"name","type","types","server","tstype","value","optional","tmp","pos","lastResult"];var Re=h(le()),B=h(D());function P(e){return typeof e=="string"?e.length:e}var Jn="moreThan";function Sn(e,t){return P(t)>e}var U={name:Jn,main:Sn,params:["num"]};var Yn="lessThan";function Mn(e,t){return P(t)<e}var G={name:Yn,main:Mn,params:["num"]};var kn="between";function Nn(e,t,n){return G.main(e,n)&&U.main(t,n)}var _e={main:Nn,name:kn,params:["max","min"]};var In="email";function Kn(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}var xe={main:Kn,name:In};var Vn="int";function Dn(e){return Number.isInteger(e)}var Ae={name:Vn,main:Dn};var Ln="lessThanEqual";function $n(e,t){return P(t)<=e}var z={name:Ln,main:$n,params:["num"]};var Un="moreThanEqual";function Gn(e,t){return P(t)>=e}var H={name:Un,main:Gn,params:["num"]};var zn="unit";function Hn(e){return Number.isInteger(e)&&e>=0}var we={name:zn,main:Hn};var Bn="main";function Wn(e,t,n){return z.main(e,n)&&H.main(t,n)}var Oe={name:Bn,main:Wn,params:["max","min"]};var fe=[_e,xe,Ae,z,G,H,U,we,Oe];function Te(e,t){let{plugin:n}=e;if(n){let r=t[f];if(r){if(!Zn(e,r))throw new B.default(`Expected params: ${r.join(",")} not found!`);let o=r.map(l=>e[l]);return Reflect.apply((0,Re.curry)(t.main),null,o)}else throw new B.default(`This plugin ${t.name} can not be curry`)}throw new B.default("Unable to find plugin in config")}function Zn(e,t){return t.filter(n=>e[n]).length===t.length}function pe(e){return(...t)=>V(this,null,function*(){let n=yield Reflect.apply(e,null,t);return n?Promise.resolve(n):Promise.reject(n)})}var Ke=h(ve()),Ve=h(D());var De=h(se()),Le=h(ae()),$e=h(Je()),gt=h(Ye()),Ue=h(ge()),X=(0,Ue.default)("jsonql:validator-core:common");function de(e){return!(e.filter(t=>Ee.includes(t)).length>0)}function Ge(e){return e[w]&&(0,$e.isFunction)(e[w])}function ze(e){let t=dt(e.main.toString());return t.pop(),t}function He(e){let t=ze(e);if(t.length===0)return e;if(!de(t))throw new Ve.default(M);return e[f]=t,e}function Be(e){let t=ze(e),n=t.length;if(n===0&&!e[f])return!0;let r=e.params!==void 0&&Array.isArray(e.params)?e.params:!1;return r===!1?!1:n>0&&n===r.length&&!t.filter((o,l)=>o!==r[l]).length}function dt(e){return e.split("(")[1].split(")")[0].split(",").map(t=>t.trim()).filter(t=>t!=="")}function ye(e,t,n){return(r,o,l)=>V(this,null,function*(){return Reflect.apply(t,null,[r]).then(yt(e,r,o,l)).catch(d=>(X("failed",e,r,d,l),Promise.reject(new Ke.default(n,l))))})}function yt(e,t,n,r){return o=>{let l=r[0];X("passed",e,t,o,r),X("lastResult",n);let d={[L]:l,[Pe]:t};if(n===void 0)return{[e]:d};if(e in n){let C=n[e];return ht(C)?C.includes(d)||n[e].push(d):C[L]!==l&&(n[e]=(0,De.toArray)(n[e]).concat([d])),n}return(0,Le.assign)(n,{[e]:d})}}function ht(e,t=L){try{if(Array.isArray(e))return!!e.filter(n=>t in n).length}catch(n){X("isResultPackage",n)}return!1}var We=h(ge()),x=(0,We.default)("jsonql:validator-core:validator-plugin"),Q=class{constructor(t){this.$version=t;this._plugins=new Map;this._internalPluginNames=[];fe.forEach(n=>{let r=n[Fe];this._internalPluginNames.push(r),this._registerPlugin(r,n,!0)})}lookupPlugin(t,n){let r=t[te];if(r&&this._plugins.has(r)){let o=this._plugins.get(r);if(o[w]&&!o[f]&&(o[Y]=pe(o[w])),o&&o[Y]&&!o[f])return ye(n,o[Y],r);if(o&&o[f])return x("pluginConfig --->",o),x("input----------->",t),ye(n,pe(Te(t,o)),r)}throw x("lookupPlugin","unable to find",r),new J.default(`Unable to find plugin: ${r}`)}registerPlugin(t,n){this._registerPlugin(t,n)}_registerExternalPlugin(t,n){this._registerPlugin(t,n,!1,!0)}export(t=!0){let n=[];return this._plugins.forEach((r,o)=>{!this.isBuiltIn(o)&&r.external===t&&n.push(r)}),n}isBuiltIn(t){return this._internalPluginNames.includes(t)}_registerPlugin(t,n,r=!1,o=!1){if(!r){if(this._plugins.has(t))throw new J.default(`plugin ${t} already existed!`);if(!Ge(n))throw x("registerPlugin",oe),new J.default(oe);if(n[f]===void 0)n=He(n),x("auto generate params for plugin",n);else if(n[f]!==void 0){if(!de(n[f]))throw x("registerPlugin",M),new J.default(M);if(!Be(n))throw x("registerPlugin",re),new J.default(re)}}n.name=t,n.external=o,this._plugins.set(t,n)}};var Ze=class extends Q{registerExternalPlugin(t,n){this._registerExternalPlugin(t,n)}};export{Ze as ExternalPluginLoader};
//# sourceMappingURL=loader.js.map
