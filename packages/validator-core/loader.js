"use strict";var an=Object.create;var Pe=Object.defineProperty;var cn=Object.getOwnPropertyDescriptor;var ln=Object.getOwnPropertyNames;var fn=Object.getPrototypeOf,pn=Object.prototype.hasOwnProperty;var h=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var mn=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ln(t))!pn.call(e,o)&&o!==n&&Pe(e,o,{get:()=>t[o],enumerable:!(r=cn(t,o))||r.enumerable});return e};var d=(e,t,n)=>(n=e!=null?an(fn(e)):{},mn(t||!e||!e.__esModule?Pe(n,"default",{value:e,enumerable:!0}):n,e));var V=(e,t,n)=>new Promise((r,o)=>{var l=F=>{try{b(n.next(F))}catch(S){o(S)}},y=F=>{try{b(n.throw(F))}catch(S){o(S)}},b=F=>F.done?r(F.value):Promise.resolve(F.value).then(l,y);b((n=n.apply(e,t)).next())});var D=h(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var A=class extends Error{constructor(...t){super(...t),this.message=t[0],this.detail=t[1],this.className=A.name,Error.captureStackTrace&&Error.captureStackTrace(this,A)}};ne.default=A});var O=h(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.trueTypeOf=void 0;function hn(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}U.trueTypeOf=hn});var se=h(c=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});c.formatStr=c.showDeep=c.nil=c.createEvtName=c.parseJson=c.toArray=c.inArray=void 0;var bn=O(),Cn=(e,t)=>e.includes(t);c.inArray=Cn;var Fn=e=>Array.isArray(e)?e:[e];c.toArray=Fn;var Pn=(e,t=!0)=>{try{return(0,bn.trueTypeOf)(e)==="string"?JSON.parse(e):JSON.parse(JSON.stringify(e))}catch(n){if(t)return e;throw n}};c.parseJson=Pn;var xn=(...e)=>e.join("_");c.createEvtName=xn;var En=()=>!1;c.nil=En;var _n=e=>{console.dir(e,{depth:null})};c.showDeep=_n;function An(e,...t){return e.replace(/{([0-9]+)}/g,(n,r)=>typeof t[r]>"u"?n:t[r])}c.formatStr=An});var ae=h(a=>{"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.readOnly=a.objectHasKey=a.arrToObj=a.assign=a.getConfigValue=a.isClass=a.isPlainObject=a.isObject=void 0;var wn=se(),On=O();function ie(e){return(0,On.trueTypeOf)(e)==="object"}a.isObject=ie;function ue(e){if(ie(e)){let n=e.constructor.prototype,r="[Object: null prototype]";return n.toString().substring(0,r.length)===r?!0:ie(n)===!1?!1:Reflect.apply(n.hasOwnProperty,n,["isPrototypeOf"])}return!1}a.isPlainObject=ue;var Rn=e=>!ue(e);a.isClass=Rn;var Tn=(e,t)=>t&&ue(t)&&e in t?t[e]:void 0;a.getConfigValue=Tn;var qn=(...e)=>Reflect.apply(Object.assign,Object,e);a.assign=qn;var vn=(e,t,n={})=>e.map(t).reduce((r,o)=>(0,a.assign)(r,o),n);a.arrToObj=vn;var jn=(e,t)=>{try{let n=Object.keys(e);return(0,wn.inArray)(n,t)}catch{return!1}};a.objectHasKey=jn;var Jn=e=>Object.freeze(e);a.readOnly=Jn});var le=h(p=>{"use strict";Object.defineProperty(p,"__esModule",{value:!0});p.isString=p.flatMap=p.merge=p.curry=void 0;var kn=O(),ce=ae(),Sn=(e,...t)=>e.length<=t.length?e(...t):(...n)=>(0,p.curry)(e,...t,...n);p.curry=Sn;var Yn=(e,...t)=>{if(!t.length)return e;let n=t.shift();if((0,ce.isObject)(e)&&(0,ce.isObject)(n))for(let r in n)(0,ce.isObject)(n[r])?(e[r]||Object.assign(e,{[r]:{}}),(0,p.merge)(e[r],n[r])):Object.assign(e,{[r]:n[r]});return(0,p.merge)(e,...t)};p.merge=Yn;function Nn(e,t){return t||(t=n=>n),e.flatMap(t)}p.flatMap=Nn;function Mn(e){return(0,kn.trueTypeOf)(e)==="string"}p.isString=Mn});var Ye=h(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});var R=class extends Error{constructor(...t){super(...t),this.message=t[0],this.detail=t[1],this.className=R.name,Error.captureStackTrace&&Error.captureStackTrace(this,R)}};de.default=R});var Ie=h(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.isAsyncFunction=T.isFunction=void 0;var Ne=O(),Me=["asyncfunction","function"],it=function(e,t=!1){let n=(0,Ne.trueTypeOf)(e);return Me.includes(n)?!0:(t&&console.error(`Expect to be Function type! Got ${typeof e}`),!1)};T.isFunction=it;function ut(e){return(0,Ne.trueTypeOf)(e)===Me[0]}T.isAsyncFunction=ut});var Ve=h(q=>{"use strict";Object.defineProperty(q,"__esModule",{value:!0});q.getRegex=q.isRegExp=void 0;var at=le();function Ke(e){return e instanceof RegExp}q.isRegExp=Ke;function ct(e){switch(!0){case Ke(e):return e;case(0,at.isString)(e):return new RegExp(e);default:return!1}}q.getRegex=ct});var Le=h((Pr,De)=>{var v=1e3,j=v*60,J=j*60,E=J*24,lt=E*7,ft=E*365.25;De.exports=function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return pt(e);if(n==="number"&&isFinite(e))return t.long?gt(e):mt(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function pt(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*ft;case"weeks":case"week":case"w":return n*lt;case"days":case"day":case"d":return n*E;case"hours":case"hour":case"hrs":case"hr":case"h":return n*J;case"minutes":case"minute":case"mins":case"min":case"m":return n*j;case"seconds":case"second":case"secs":case"sec":case"s":return n*v;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function mt(e){var t=Math.abs(e);return t>=E?Math.round(e/E)+"d":t>=J?Math.round(e/J)+"h":t>=j?Math.round(e/j)+"m":t>=v?Math.round(e/v)+"s":e+"ms"}function gt(e){var t=Math.abs(e);return t>=E?W(e,t,E,"day"):t>=J?W(e,t,J,"hour"):t>=j?W(e,t,j,"minute"):t>=v?W(e,t,v,"second"):e+" ms"}function W(e,t,n,r){var o=t>=n*1.5;return Math.round(e/n)+" "+r+(o?"s":"")}});var $e=h((xr,Ue)=>{function dt(e){n.debug=n,n.default=n,n.coerce=F,n.disable=l,n.enable=o,n.enabled=y,n.humanize=Le(),n.destroy=S,Object.keys(e).forEach(s=>{n[s]=e[s]}),n.names=[],n.skips=[],n.formatters={};function t(s){let i=0;for(let u=0;u<s.length;u++)i=(i<<5)-i+s.charCodeAt(u),i|=0;return n.colors[Math.abs(i)%n.colors.length]}n.selectColor=t;function n(s){let i,u=null,M,Ce;function C(...g){if(!C.enabled)return;let x=C,I=Number(new Date),on=I-(i||I);x.diff=on,x.prev=i,x.curr=I,i=I,g[0]=n.coerce(g[0]),typeof g[0]!="string"&&g.unshift("%O");let K=0;g[0]=g[0].replace(/%([a-zA-Z%])/g,(ee,sn)=>{if(ee==="%%")return"%";K++;let Fe=n.formatters[sn];if(typeof Fe=="function"){let un=g[K];ee=Fe.call(x,un),g.splice(K,1),K--}return ee}),n.formatArgs.call(x,g),(x.log||n.log).apply(x,g)}return C.namespace=s,C.useColors=n.useColors(),C.color=n.selectColor(s),C.extend=r,C.destroy=n.destroy,Object.defineProperty(C,"enabled",{enumerable:!0,configurable:!1,get:()=>u!==null?u:(M!==n.namespaces&&(M=n.namespaces,Ce=n.enabled(s)),Ce),set:g=>{u=g}}),typeof n.init=="function"&&n.init(C),C}function r(s,i){let u=n(this.namespace+(typeof i>"u"?":":i)+s);return u.log=this.log,u}function o(s){n.save(s),n.namespaces=s,n.names=[],n.skips=[];let i,u=(typeof s=="string"?s:"").split(/[\s,]+/),M=u.length;for(i=0;i<M;i++)!u[i]||(s=u[i].replace(/\*/g,".*?"),s[0]==="-"?n.skips.push(new RegExp("^"+s.slice(1)+"$")):n.names.push(new RegExp("^"+s+"$")))}function l(){let s=[...n.names.map(b),...n.skips.map(b).map(i=>"-"+i)].join(",");return n.enable(""),s}function y(s){if(s[s.length-1]==="*")return!0;let i,u;for(i=0,u=n.skips.length;i<u;i++)if(n.skips[i].test(s))return!1;for(i=0,u=n.names.length;i<u;i++)if(n.names[i].test(s))return!0;return!1}function b(s){return s.toString().substring(2,s.toString().length-2).replace(/\.\*\?$/,"*")}function F(s){return s instanceof Error?s.stack||s.message:s}function S(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}Ue.exports=dt});var ye=h((m,Z)=>{m.formatArgs=ht;m.save=bt;m.load=Ct;m.useColors=yt;m.storage=Ft();m.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();m.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function yt(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function ht(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Z.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(r=n))}),e.splice(r,0,t)}m.log=console.debug||console.log||(()=>{});function bt(e){try{e?m.storage.setItem("debug",e):m.storage.removeItem("debug")}catch{}}function Ct(){let e;try{e=m.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function Ft(){try{return localStorage}catch{}}Z.exports=$e()(m);var{formatters:Pt}=Z.exports;Pt.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var k=d(D());var gn="validate",Y="validateAsync",te="plugin",w="main",dn="pattern",yn="rules",xe="name",f="params",L="$$idx",Ee="$$value",N="Your plugin config argument contains reserved keywords",re="Your params doesn't matching your main argument list",oe="Can not find 'main' method in your plugin config",_e=[f,dn,gn,Y,te,yn,"name","type","types","server","tstype","value","optional","tmp","pos","lastResult"];var ke=d(le()),B=d(D());function P(e){return typeof e=="string"?e.length:e}var In="moreThan";function Kn(e,t){return P(t)>e}var $={name:In,main:Kn,params:["num"]};var Vn="lessThan";function Dn(e,t){return P(t)<e}var G={name:Vn,main:Dn,params:["num"]};var Ln="between";function Un(e,t,n){return G.main(e,n)&&$.main(t,n)}var Ae={main:Un,name:Ln,params:["max","min"]};var $n="email";function Gn(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}var we={main:Gn,name:$n};var fe=d(O()),Oe="number";function pe(e){return(0,fe.trueTypeOf)(e)===Oe&&Number.isInteger(e)}function Re(e){return(0,fe.trueTypeOf)(e)===Oe&&!isNaN(e)&&!Number.isInteger(e)}function Te(e){return pe(e)&&e>=0}var zn="float";function Hn(e){return Re(e)}var qe={name:zn,main:Hn};var Bn="int";function Wn(e){return pe(e)}var ve={name:Bn,main:Wn};var Zn="lessThanEqual";function Xn(e,t){return P(t)<=e}var z={name:Zn,main:Xn,params:["num"]};var Qn="moreThanEqual";function et(e,t){return P(t)>=e}var H={name:Qn,main:et,params:["num"]};var nt="unit";function tt(e){return Te(e)}var je={name:nt,main:tt};var rt="main";function ot(e,t,n){return z.main(e,n)&&H.main(t,n)}var Je={name:rt,main:ot,params:["max","min"]};var me=[Ae,we,qe,ve,z,G,H,$,je,Je];function Se(e,t){let{plugin:n}=e;if(n){let r=t[f];if(r){if(!st(e,r))throw new B.default(`Expected params: ${r.join(",")} not found!`);let o=r.map(l=>e[l]);return Reflect.apply((0,ke.curry)(t.main),null,o)}else throw new B.default(`This plugin ${t.name} can not be curry`)}throw new B.default("Unable to find plugin in config")}function st(e,t){return t.filter(n=>e[n]).length===t.length}function ge(e){return(...t)=>V(this,null,function*(){let n=yield Reflect.apply(e,null,t);return n?Promise.resolve(n):Promise.reject(n)})}var Ge=d(Ye()),ze=d(D());var He=d(se()),Be=d(ae()),We=d(Ie()),xt=d(Ve()),Ze=d(ye()),X=(0,Ze.default)("jsonql:validator-core:common");function he(e){return!(e.filter(t=>_e.includes(t)).length>0)}function Xe(e){return e[w]&&(0,We.isFunction)(e[w])}function Qe(e){let t=Et(e.main.toString());return t.pop(),t}function en(e){let t=Qe(e);if(t.length===0)return e;if(!he(t))throw new ze.default(N);return e[f]=t,e}function nn(e){let t=Qe(e),n=t.length;if(n===0&&!e[f])return!0;let r=e.params!==void 0&&Array.isArray(e.params)?e.params:!1;return r===!1?!1:n>0&&n===r.length&&!t.filter((o,l)=>o!==r[l]).length}function Et(e){return e.split("(")[1].split(")")[0].split(",").map(t=>t.trim()).filter(t=>t!=="")}function be(e,t,n){return(r,o,l)=>V(this,null,function*(){return Reflect.apply(t,null,[r]).then(_t(e,r,o,l)).catch(y=>(X("failed",e,r,y,l),Promise.reject(new Ge.default(n,l))))})}function _t(e,t,n,r){return o=>{let l=r[0];X("passed",e,t,o,r),X("lastResult",n);let y={[L]:l,[Ee]:t};if(n===void 0)return{[e]:y};if(e in n){let b=n[e];return At(b)?b.includes(y)||n[e].push(y):b[L]!==l&&(n[e]=(0,He.toArray)(n[e]).concat([y])),n}return(0,Be.assign)(n,{[e]:y})}}function At(e,t=L){try{if(Array.isArray(e))return!!e.filter(n=>t in n).length}catch(n){X("isResultPackage",n)}return!1}var tn=d(ye()),_=(0,tn.default)("jsonql:validator-core:validator-plugin"),Q=class{constructor(t){this.$version=t;this._plugins=new Map;this._internalPluginNames=[];me.forEach(n=>{let r=n[xe];this._internalPluginNames.push(r),this._registerPlugin(r,n,!0)})}lookupPlugin(t,n){let r=t[te];if(r&&this._plugins.has(r)){let o=this._plugins.get(r);if(o[w]&&!o[f]&&(o[Y]=ge(o[w])),o&&o[Y]&&!o[f])return be(n,o[Y],r);if(o&&o[f])return _("pluginConfig --->",o),_("input----------->",t),be(n,ge(Se(t,o)),r)}throw _("lookupPlugin","unable to find",r),new k.default(`Unable to find plugin: ${r}`)}registerPlugin(t,n){this._registerPlugin(t,n)}_registerExternalPlugin(t,n){this._registerPlugin(t,n,!1,!0)}export(t=!0){let n=[];return this._plugins.forEach((r,o)=>{!this.isBuiltIn(o)&&r.external===t&&n.push(r)}),n}isBuiltIn(t){return this._internalPluginNames.includes(t)}_registerPlugin(t,n,r=!1,o=!1){if(!r){if(this._plugins.has(t))throw new k.default(`plugin ${t} already existed!`);if(!Xe(n))throw _("registerPlugin",oe),new k.default(oe);if(n[f]===void 0)n=en(n),_("auto generate params for plugin",n);else if(n[f]!==void 0){if(!he(n[f]))throw _("registerPlugin",N),new k.default(N);if(!nn(n))throw _("registerPlugin",re),new k.default(re)}}n.name=t,n.external=o,this._plugins.set(t,n)}};var rn=class extends Q{registerExternalPlugin(t,n){this._registerExternalPlugin(t,n)}};export{rn as ExternalPluginLoader};
//# sourceMappingURL=loader.js.map
