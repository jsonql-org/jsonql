"use strict";var an=Object.create;var Fe=Object.defineProperty;var cn=Object.getOwnPropertyDescriptor;var ln=Object.getOwnPropertyNames;var fn=Object.getPrototypeOf,pn=Object.prototype.hasOwnProperty;var y=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var mn=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of ln(t))!pn.call(e,o)&&o!==n&&Fe(e,o,{get:()=>t[o],enumerable:!(r=cn(t,o))||r.enumerable});return e};var g=(e,t,n)=>(n=e!=null?an(fn(e)):{},mn(t||!e||!e.__esModule?Fe(n,"default",{value:e,enumerable:!0}):n,e));var V=(e,t,n)=>new Promise((r,o)=>{var c=C=>{try{h(n.next(C))}catch(J){o(J)}},d=C=>{try{h(n.throw(C))}catch(J){o(J)}},h=C=>C.done?r(C.value):Promise.resolve(C.value).then(c,d);h((n=n.apply(e,t)).next())});var D=y(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});var A=class extends Error{constructor(...t){super(...t),this.message=t[0],this.detail=t[1],this.className=A.name,Error.captureStackTrace&&Error.captureStackTrace(this,A)}};ne.default=A});var S=y(U=>{"use strict";Object.defineProperty(U,"__esModule",{value:!0});U.trueTypeOf=void 0;function hn(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}U.trueTypeOf=hn});var se=y(x=>{"use strict";Object.defineProperty(x,"__esModule",{value:!0});x.compact=x.toArray=x.inArray=void 0;var bn=(e,t)=>e.includes(t);x.inArray=bn;var Cn=e=>Array.isArray(e)?e:[e];x.toArray=Cn;var xn=e=>e.filter(Boolean);x.compact=xn});var ae=y(u=>{"use strict";Object.defineProperty(u,"__esModule",{value:!0});u.readOnly=u.objectHasKey=u.arrToObj=u.extend=u.assign=u.getConfigValue=u.isClass=u.isPlainObject=u.isObject=void 0;var Fn=se(),Pn=S();function ie(e){return(0,Pn.trueTypeOf)(e)==="object"}u.isObject=ie;function ue(e){if(ie(e)){let n=e.constructor.prototype,r="[Object: null prototype]";return n.toString().substring(0,r.length)===r?!0:ie(n)===!1?!1:Reflect.apply(n.hasOwnProperty,n,["isPrototypeOf"])}return!1}u.isPlainObject=ue;var _n=e=>!ue(e);u.isClass=_n;var En=(e,t)=>t&&ue(t)&&e in t?t[e]:void 0;u.getConfigValue=En;var An=(...e)=>Reflect.apply(Object.assign,Object,e);u.assign=An;u.extend=u.assign;var wn=(e,t,n={})=>e.map(t).reduce((r,o)=>(0,u.assign)(r,o),n);u.arrToObj=wn;var On=(e,t)=>{try{let n=Object.keys(e);return(0,Fn.inArray)(n,t)}catch{return!1}};u.objectHasKey=On;var Rn=e=>Object.freeze(e);u.readOnly=Rn});var le=y(f=>{"use strict";Object.defineProperty(f,"__esModule",{value:!0});f.isString=f.flatMap=f.merge=f.curry=void 0;var Tn=S(),ce=ae(),qn=(e,...t)=>e.length<=t.length?e(...t):(...n)=>(0,f.curry)(e,...t,...n);f.curry=qn;var jn=(e,...t)=>{if(!t.length)return e;let n=t.shift();if((0,ce.isObject)(e)&&(0,ce.isObject)(n))for(let r in n)(0,ce.isObject)(n[r])?(e[r]||Object.assign(e,{[r]:{}}),(0,f.merge)(e[r],n[r])):Object.assign(e,{[r]:n[r]});return(0,f.merge)(e,...t)};f.merge=jn;function vn(e,t){return t||(t=n=>n),e.flatMap(t)}f.flatMap=vn;function kn(e){return(0,Tn.trueTypeOf)(e)==="string"}f.isString=kn});var Me=y(de=>{"use strict";Object.defineProperty(de,"__esModule",{value:!0});var O=class extends Error{constructor(...t){super(...t),this.message=t[0],this.detail=t[1],this.className=O.name,Error.captureStackTrace&&Error.captureStackTrace(this,O)}};de.default=O});var Ne=y(R=>{"use strict";Object.defineProperty(R,"__esModule",{value:!0});R.isAsyncFunction=R.isFunction=void 0;var Se=S(),Ie=["asyncfunction","function"],nt=function(e,t=!1){let n=(0,Se.trueTypeOf)(e);return Ie.includes(n)?!0:(t&&console.error(`Expect to be Function type! Got ${typeof e}`),!1)};R.isFunction=nt;function tt(e){return(0,Se.trueTypeOf)(e)===Ie[0]}R.isAsyncFunction=tt});var Ve=y(T=>{"use strict";Object.defineProperty(T,"__esModule",{value:!0});T.getRegex=T.isRegExp=void 0;var rt=le();function Ke(e){return e instanceof RegExp}T.isRegExp=Ke;function ot(e){switch(!0){case Ke(e):return e;case(0,rt.isString)(e):return new RegExp(e);default:return!1}}T.getRegex=ot});var Le=y((yr,De)=>{var q=1e3,j=q*60,v=j*60,_=v*24,st=_*7,it=_*365.25;De.exports=function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return ut(e);if(n==="number"&&isFinite(e))return t.long?ct(e):at(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function ut(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!!t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*it;case"weeks":case"week":case"w":return n*st;case"days":case"day":case"d":return n*_;case"hours":case"hour":case"hrs":case"hr":case"h":return n*v;case"minutes":case"minute":case"mins":case"min":case"m":return n*j;case"seconds":case"second":case"secs":case"sec":case"s":return n*q;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function at(e){var t=Math.abs(e);return t>=_?Math.round(e/_)+"d":t>=v?Math.round(e/v)+"h":t>=j?Math.round(e/j)+"m":t>=q?Math.round(e/q)+"s":e+"ms"}function ct(e){var t=Math.abs(e);return t>=_?W(e,t,_,"day"):t>=v?W(e,t,v,"hour"):t>=j?W(e,t,j,"minute"):t>=q?W(e,t,q,"second"):e+" ms"}function W(e,t,n,r){var o=t>=n*1.5;return Math.round(e/n)+" "+r+(o?"s":"")}});var $e=y((hr,Ue)=>{function lt(e){n.debug=n,n.default=n,n.coerce=C,n.disable=c,n.enable=o,n.enabled=d,n.humanize=Le(),n.destroy=J,Object.keys(e).forEach(s=>{n[s]=e[s]}),n.names=[],n.skips=[],n.formatters={};function t(s){let i=0;for(let a=0;a<s.length;a++)i=(i<<5)-i+s.charCodeAt(a),i|=0;return n.colors[Math.abs(i)%n.colors.length]}n.selectColor=t;function n(s){let i,a=null,I,Ce;function b(...m){if(!b.enabled)return;let P=b,N=Number(new Date),on=N-(i||N);P.diff=on,P.prev=i,P.curr=N,i=N,m[0]=n.coerce(m[0]),typeof m[0]!="string"&&m.unshift("%O");let K=0;m[0]=m[0].replace(/%([a-zA-Z%])/g,(ee,sn)=>{if(ee==="%%")return"%";K++;let xe=n.formatters[sn];if(typeof xe=="function"){let un=m[K];ee=xe.call(P,un),m.splice(K,1),K--}return ee}),n.formatArgs.call(P,m),(P.log||n.log).apply(P,m)}return b.namespace=s,b.useColors=n.useColors(),b.color=n.selectColor(s),b.extend=r,b.destroy=n.destroy,Object.defineProperty(b,"enabled",{enumerable:!0,configurable:!1,get:()=>a!==null?a:(I!==n.namespaces&&(I=n.namespaces,Ce=n.enabled(s)),Ce),set:m=>{a=m}}),typeof n.init=="function"&&n.init(b),b}function r(s,i){let a=n(this.namespace+(typeof i>"u"?":":i)+s);return a.log=this.log,a}function o(s){n.save(s),n.namespaces=s,n.names=[],n.skips=[];let i,a=(typeof s=="string"?s:"").split(/[\s,]+/),I=a.length;for(i=0;i<I;i++)!a[i]||(s=a[i].replace(/\*/g,".*?"),s[0]==="-"?n.skips.push(new RegExp("^"+s.slice(1)+"$")):n.names.push(new RegExp("^"+s+"$")))}function c(){let s=[...n.names.map(h),...n.skips.map(h).map(i=>"-"+i)].join(",");return n.enable(""),s}function d(s){if(s[s.length-1]==="*")return!0;let i,a;for(i=0,a=n.skips.length;i<a;i++)if(n.skips[i].test(s))return!1;for(i=0,a=n.names.length;i<a;i++)if(n.names[i].test(s))return!0;return!1}function h(s){return s.toString().substring(2,s.toString().length-2).replace(/\.\*\?$/,"*")}function C(s){return s instanceof Error?s.stack||s.message:s}function J(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}Ue.exports=lt});var ye=y((p,Z)=>{p.formatArgs=pt;p.save=mt;p.load=gt;p.useColors=ft;p.storage=dt();p.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();p.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function ft(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function pt(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+Z.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(r=n))}),e.splice(r,0,t)}p.log=console.debug||console.log||(()=>{});function mt(e){try{e?p.storage.setItem("debug",e):p.storage.removeItem("debug")}catch{}}function gt(){let e;try{e=p.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function dt(){try{return localStorage}catch{}}Z.exports=$e()(p);var{formatters:yt}=Z.exports;yt.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var k=g(D());var gn="validate",Y="validateAsync",te="plugin",w="main",dn="pattern",yn="rules",Pe="name",l="params",L="$$idx",_e="$$value",M="Your plugin config argument contains reserved keywords",re="Your params doesn't matching your main argument list",oe="Can not find 'main' method in your plugin config",Ee=[l,dn,gn,Y,te,yn,"name","type","types","server","tstype","value","optional","tmp","pos","lastResult"];var Je=g(le()),H=g(D());function F(e){return typeof e=="string"?e.length:e}var Jn="moreThan";function Yn(e,t){return F(t)>e}var $={name:Jn,main:Yn,params:["num"]};var Mn="lessThan";function Sn(e,t){return F(t)<e}var G={name:Mn,main:Sn,params:["num"]};var In="between";function Nn(e,t,n){return G.main(e,n)&&$.main(t,n)}var Ae={main:Nn,name:In,params:["max","min"]};var Kn="email";function Vn(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}var we={main:Vn,name:Kn};var fe=g(S()),Oe="number";function pe(e){return(0,fe.trueTypeOf)(e)===Oe&&Number.isInteger(e)}function Re(e){return(0,fe.trueTypeOf)(e)===Oe&&!isNaN(e)&&!Number.isInteger(e)}function Te(e){return pe(e)&&e>=0}var Dn="float";function Ln(e){return Re(e)}var qe={name:Dn,main:Ln};var Un="int";function $n(e){return pe(e)}var je={name:Un,main:$n};var Gn="lessThanEqual";function zn(e,t){return F(t)<=e}var z={name:Gn,main:zn,params:["num"]};var Bn="moreThanEqual";function Hn(e,t){return F(t)>=e}var B={name:Bn,main:Hn,params:["num"]};var Wn="unit";function Zn(e){return Te(e)}var ve={name:Wn,main:Zn};var Xn="main";function Qn(e,t,n){return z.main(e,n)&&B.main(t,n)}var ke={name:Xn,main:Qn,params:["max","min"]};var me=[Ae,we,qe,je,z,G,B,$,ve,ke];function Ye(e,t){let{plugin:n}=e;if(n){let r=t[l];if(r){if(!et(e,r))throw new H.default(`Expected params: ${r.join(",")} not found!`);let o=r.map(c=>e[c]);return Reflect.apply((0,Je.curry)(t.main),null,o)}else throw new H.default(`This plugin ${t.name} can not be curry`)}throw new H.default("Unable to find plugin in config")}function et(e,t){return t.filter(n=>e[n]).length===t.length}function ge(e){return(...t)=>V(this,null,function*(){let n=yield Reflect.apply(e,null,t);return n?Promise.resolve(n):Promise.reject(n)})}var Ge=g(Me()),ze=g(D());var Be=g(se()),He=g(ae()),We=g(Ne()),ht=g(Ve()),Ze=g(ye()),X=(0,Ze.default)("jsonql:validator-core:common");function he(e){return!(e.filter(t=>Ee.includes(t)).length>0)}function Xe(e){return e[w]&&(0,We.isFunction)(e[w])}function Qe(e){let t=bt(e.main.toString());return t.pop(),t}function en(e){let t=Qe(e);if(t.length===0)return e;if(!he(t))throw new ze.default(M);return e[l]=t,e}function nn(e){let t=Qe(e),n=t.length;if(n===0&&!e[l])return!0;let r=e.params!==void 0&&Array.isArray(e.params)?e.params:!1;return r===!1?!1:n>0&&n===r.length&&!t.filter((o,c)=>o!==r[c]).length}function bt(e){return e.split("(")[1].split(")")[0].split(",").map(t=>t.trim()).filter(t=>t!=="")}function be(e,t,n){return(r,o,c)=>V(this,null,function*(){return Reflect.apply(t,null,[r]).then(Ct(e,r,o,c)).catch(d=>(X("failed",e,r,d,c),Promise.reject(new Ge.default(n,c))))})}function Ct(e,t,n,r){return o=>{let c=r[0];X("passed",e,t,o,r),X("lastResult",n);let d={[L]:c,[_e]:t};if(n===void 0)return{[e]:d};if(e in n){let h=n[e];return xt(h)?h.includes(d)||n[e].push(d):h[L]!==c&&(n[e]=(0,Be.toArray)(n[e]).concat([d])),n}return(0,He.extend)(n,{[e]:d})}}function xt(e,t=L){try{if(Array.isArray(e))return!!e.filter(n=>t in n).length}catch(n){X("isResultPackage",n)}return!1}var tn=g(ye()),E=(0,tn.default)("jsonql:validator-core:validator-plugin"),Q=class{constructor(t){this.$version=t;this._plugins=new Map;this._internalPluginNames=[];me.forEach(n=>{let r=n[Pe];this._internalPluginNames.push(r),this._registerPlugin(r,n,!0)})}lookupPlugin(t,n){let r=t[te];if(r&&this._plugins.has(r)){let o=this._plugins.get(r);if(o[w]&&!o[l]&&(o[Y]=ge(o[w])),o&&o[Y]&&!o[l])return be(n,o[Y],r);if(o&&o[l])return E("pluginConfig --->",o),E("input----------->",t),be(n,ge(Ye(t,o)),r)}throw E("lookupPlugin","unable to find",r),new k.default(`Unable to find plugin: ${r}`)}registerPlugin(t,n){this._registerPlugin(t,n)}_registerExternalPlugin(t,n){this._registerPlugin(t,n,!1,!0)}export(t=!0){let n=[];return this._plugins.forEach((r,o)=>{!this.isBuiltIn(o)&&r.external===t&&n.push(r)}),n}isBuiltIn(t){return this._internalPluginNames.includes(t)}_registerPlugin(t,n,r=!1,o=!1){if(!r){if(this._plugins.has(t))throw new k.default(`plugin ${t} already existed!`);if(!Xe(n))throw E("registerPlugin",oe),new k.default(oe);if(n[l]===void 0)n=en(n),E("auto generate params for plugin",n);else if(n[l]!==void 0){if(!he(n[l]))throw E("registerPlugin",M),new k.default(M);if(!nn(n))throw E("registerPlugin",re),new k.default(re)}}n.name=t,n.external=o,this._plugins.set(t,n)}};var rn=class extends Q{registerExternalPlugin(t,n){this._registerExternalPlugin(t,n)}};export{rn as ExternalPluginLoader};
//# sourceMappingURL=loader.js.map
